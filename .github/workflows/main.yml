name: ffmpeg-win-arm64 automated builds

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Version Tag to build'
        required: true
        type: string
      build-type:
        description: 'Build type of executable'
        required: true
        default: 'essentials'
        type: choice
        options:
        - essentials
        - full
      link-type:
        description: 'Link type of libraries'
        required: true
        default: 'shared'
        type: choice
        options:
        - shared
        - static
      msystem:
        description: 'MSYS2 System Environment'
        required: true
        default: 'clangarm64'
        type: choice
        options:
        - clang64
        - clangarm64
  push:
    paths-ignore:
      - '**.md'
      - '.vscode/**'
      # - '.github/**'
      - '.devcontainer/**'
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  generate_matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix_json: ${{ steps.set-matrix.outputs.matrix_json }}
    steps:
      - uses: actions/checkout@v5
      - name: Generate Matrix JSON
        working-directory: '/config'
        id: set-matrix
        run: |
          # Define your JSON array. It must be a single line.
          # The structure below is for a matrix that will have two variables: project and config.
          JSON_OUTPUT='{"include":[{"project":"foo","config":"Debug"},{"project":"bar","config":"Release"}]}'
          
          # Set the output variable
          echo "matrix_json=$JSON_OUTPUT" >> $GITHUB_OUTPUT
          if [ -f options.json ]; then
              echo "options.json exists and is a regular file."
          else
              echo "$FILE does not exist or is not a regular file."
          fi
  run_matrix_jobs:
    needs: generate_matrix
    runs-on: ubuntu-latest
    strategy:
      # Use fromJson() to convert the output string into a matrix
      matrix: ${{ fromJson(needs.generate_matrix.outputs.matrix_json) }}
    steps:
      - name: Use Matrix Values
        run: |
          echo "Running job for project: ${{ matrix.project }} and config: ${{ matrix.config }}"

# jobs:
#   # msys2:
#   #   name: 'üßë‚Äçüíª MSYS2 Environment'
#   #   uses: ./.github/workflows/msys2.yml
#   #   secrets: inherit
#   #   with:
#   #     environment: ${{ inputs.build-env }}
#   #     msystem: ${{ inputs.msystem }}
#   json:
#     environment: 'base'
#     runs-on: ubuntu-latest
#     outputs:
#       matrix: ${{ steps.json-matrix.outputs.matrix }}
#     steps:
#       - uses: actions/checkout@v5
#       - id: json-matrix
#         working-directory: './config'
#         run: |
#           # Define your JSON array. For a file, use: jq -c . < ./config.json
#           JSON_DATA='[{"name": "Mario", "config": "Debug"}, {"name": "Luigi", "config": "Release"}]'
          
#           # Use jq to compact the JSON to a single line and set as an output
#           # The quotes around the output value are important for correct parsing
#           echo "matrix=$(echo "$JSON_DATA" | jq -c .)" >> "$GITHUB_OUTPUT"
          
#           # if [ -f options.json ]; then
#           #     # echo "options.json exists and is a regular file."
#           #     echo "matrix=$(jq -c . < options.json)" >> $GITHUB_ENV
#           #     # echo "PACKAGE_JSON=$(jq -c . < package.json)" >> $GITHUB_ENV
#           # else
#           #     echo "$FILE does not exist or is not a regular file."
#           # fi
#           # echo $matrix
#           # echo $(jq -c . < options.json)
#   jsontest:
#     environment: 'base'
#     runs-on: ubuntu-latest
#     strategy:
#       fail-fast: false
#       matrix:
#         project: ${{ fromJSON(needs.json.outputs.matrix) }}
#     steps:
#       - uses: actions/checkout@v5
#       - id: json-test
#         run: |
#           echo "test"


          
  # install-packages:
  #   needs: ['msys2']
  #   name: 'install packages'
  #   runs-on: windows-11-arm
  #   steps:
  #     - uses: msys2/setup-msys2@v2
  #     - name: 'test'
  #       shell: msys2 {0}
  #       run: |
