name: ffmpeg-win-arm64 automated builds

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Version Tag to build'
        required: true
        type: string
      build-type:
        description: 'Build type of executable'
        required: true
        default: 'essentials'
        type: choice
        options:
        - essentials
        - full
      link-type:
        description: 'Link type of libraries'
        required: true
        default: 'shared'
        type: choice
        options:
        - shared
        - static
      msystem:
        description: 'MSYS2 System Environment'
        required: true
        default: 'clangarm64'
        type: choice
        options:
        - CLANG64
        - CLANGARM64
  push:
    paths-ignore:
      - '**.md'
      - '.vscode/**'
      # - '.github/**'
      - '.devcontainer/**'
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  msys_prefix: 'mingw-w64'
  toolchain_arch: 'clang-aarch64'
  package_prefix: 'mingw-w64-clang-aarch64'

jobs:
  msys2:
    name: 'ðŸ§‘â€ðŸ’» MSYS2 Environment'
    uses: ./.github/workflows/msys2.yml
    secrets: inherit
    with:
      environment: ${{ inputs.build-env }}
      msystem: ${{ inputs.msystem }}
  setup-toolchain-info:
    needs: ['msys2']
    name: 'Setup Environment Toolchain Basics'
    runs-on: windows-11-arm
    steps:
      - uses: msys2/setup-msys2@v2
      - name: 'test'
        shell: msys2 {0}
        run: |
          echo ${${{ inputs.msystem }},,}
          echo $msys_prefix
          echo $toolchain_arch
          if [[ ${${{ inputs.msystem }},,} == "clangarm64" ]]; then
              echo "toolchain_arch=clang-aarch64" >> $GITHUB_ENV

          elif [[ ${${{ inputs.msystem }},,} == "clang64" ]]; then
              echo "toolchain_arch=clang-x86_64" >> $GITHUB_ENV
          fi
          echo "package_prefix=$msys_prefix-$toolchain_arch" >> $GITHUB_ENV
          echo $package_prefix