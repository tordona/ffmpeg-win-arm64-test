name: 'FFmpeg Configuration Bits'
description: 'Add bits to FFmpeg config setup'
inputs:
  version:
    description: 'FFmpeg version from checked out source'
    required: true
  build_type:
    description: 'Build type of included libraries'
    required: true
  link_type:
    description: 'Link type of libraries'
    required: true
  msystem:
    description: 'MSYS Environment'
    required: true
  msys_path:
    description: 'Relative path of MSYS Environment'
    required: true
  arch:
    description: 'CPU Architecture'
    required: true
  ffmpeg_config:
    description: 'FFmpeg Baseline Configuration'
    required: true
outputs:
  output_path:
    description: 'Add bits to FFmpeg config setup'
    value: ${{ steps.step2.outputs.random-number }}
  build_file_ref:
    description: 'Filename of readme file included with generated build archive'
    value: ${{ steps.step2.outputs.random-number }}
  version_name:
    description: 'Version header string'
    value: ${{ steps.step2.outputs.random-number }}
  build_config:
    description: 'Updated build configuration'
    value: ${{ steps.build-config.outputs.build_config }}
  path_msys_include:
    description: "MSYS Path to lib includes"
    value: ${{ steps.path-msys-include.outputs.path_msys_include }}

runs:
  using: "composite"
  steps:
    - name: Include path
      id: 'path-msys-include'
      shell: bash
      run: |
        msys_path="${{ inputs.msys_path }}"
        msys_path="${msys_path//\\//}"
        include_path="/${msys_path//:}/${{ inputs.msystem }}/include"
        include_path="${include_path,,}"
        echo "path_msys_include=${include_path}" >> $GITHUB_OUTPUT
    - name: Output path
      id: 'output-path'
      shell: bash
      run: |
        path=$(pwd)
        path="${path}/ffmpeg-${{ inputs.link_type }}"
        echo "output_path=${path}" >> $GITHUB_OUTPUT
    - name: Echo a config settings
      id: 'version-name'
      shell: bash
      run: |
        cpu="arm64"
        if [[ ${{ inputs.msystem }} == "CLANG64" ]]; then
          cpu="x64"
        fi
        version_name="ffmpeg-${{ inputs.version }}-${{ inputs.build_type }}-${{ inputs.link_type}}-win-${cpu}"
        echo "$version_name"
    - name: Echo a config settings
      id: 'build-config'
      shell: bash
      run: |
        temp_config="--extra-cflags=-I${{ steps.path-msys-include.outputs.path_msys_include }}"

        echo "ffmpeg_config ============"
        echo "$inputs.ffmpeg_config"
        # --prefix=$output_path/$version_name
        # --datadir=$output_path/$version_name/presets
        # --docdir=$output_path/$version_name/docs
        # --libdir=$output_path/dump/libs
        # --incdir=$output_path/dump/include 
        # --extra-cflags=-I/d/msys64/clangarm64/include
        echo "build_config=${temp_build_config}" >> $GITHUB_OUTPUT


# output_path="${path_base}/ffmpeg-${link_type}"
# build_file_ref="$build_type-${link_type}.txt"
# version_name="ffmpeg-$version-$build_type-$link_type-win-arm64"

# --prefix=$output_path/$version_name
# --datadir=$output_path/$version_name/presets
# --docdir=$output_path/$version_name/docs
# --libdir=$output_path/dump/libs
# --incdir=$output_path/dump/include 
# --extra-cflags=-I/d/msys64/clangarm64/include


# --prefix=/d/builds/ffmpeg-static/ffmpeg-8.0.1-full-static-win-arm64
# --datadir=/d/builds/ffmpeg-static/ffmpeg-8.0.1-full-static-win-arm64/presets
# --docdir=/d/builds/ffmpeg-static/ffmpeg-8.0.1-full-static-win-arm64/docs
# --libdir=/d/builds/ffmpeg-static/dump/libs
# --incdir=/d/builds/ffmpeg-static/dump/include
# --extra-cflags=-I/d/msys64/clangarm64/include
